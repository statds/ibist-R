% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/rate_test.R
\name{rate.test}
\alias{rate.test}
\title{Test of Poisson Rates Using Normal Approximation}
\usage{
rate.test(
  x,
  T,
  r = NULL,
  alternative = c("two.sided", "less", "greater"),
  conf.level = 0.95,
  correct = TRUE
)
}
\arguments{
\item{x}{a vector of event counts. A single value specifies a one-sample
test; a vector of length two specifies a two-sample comparison.}

\item{T}{a vector of exposures corresponding to \code{x} (e.g., person-time).
Must have the same length as \code{x}.}

\item{r}{a positive number specifying the null rate per unit exposure,
\eqn{\lambda_0}, for a one-sample test. Ignored for two-sample tests.}

\item{alternative}{a character string specifying the alternative hypothesis,
one of \code{"two.sided"}, \code{"less"}, or \code{"greater"}.}

\item{conf.level}{confidence level for the confidence interval.}

\item{correct}{logical; if \code{TRUE}, applies a continuity correction on
the count scale. For one-sample tests, a \eqn{\pm 0.5} correction is applied
to \eqn{x} in the direction determined by \code{alternative}. For
\code{"two.sided"}, the correction uses the sign of \eqn{x-\mu_0}.}
}
\value{
An object of class \code{"htest"} containing:
\item{statistic}{the standardized normal statistic \code{z}.}
\item{parameter}{degrees of freedom (\code{df = 1}).}
\item{p.value}{the p-value.}
\item{conf.int}{a confidence interval for the difference between the two
  rates, \eqn{\lambda_1-\lambda_2}, for two-sample tests.}
\item{estimate}{estimated rate (one-sample) or estimated rates (two-sample).}
\item{null.value}{the null rate (one-sample) or the null rate difference
  \eqn{\lambda_1-\lambda_2=0} (two-sample).}
\item{alternative}{the alternative hypothesis.}
\item{method}{a character string describing the test.}
\item{data.name}{a character string describing the data.}
}
\description{
Performs a large-sample (normal) test for one or two Poisson rates with known
exposures. The test is carried out on the observed count scale and then
translated to rates for reporting.
}
\details{
One-sample test:
Assume \eqn{X \sim \mathrm{Pois}(\mu)} with \eqn{\mu = \lambda T}. The null
hypothesis is \eqn{H_0:\lambda=\lambda_0}, where \eqn{\lambda_0=r}. Let
\eqn{\mu_0=\lambda_0 T}. The normal approximation gives
\deqn{Z = \frac{(x - c) - \mu_0}{\sqrt{\mu_0}} \approx N(0,1),}
where \eqn{c} is 0 if \code{correct=FALSE} and is a continuity correction on
the count scale if \code{correct=TRUE}. Two-sided p-values use
\eqn{2\{1-\Phi(|Z|)\}}.

#' Two-sample test:
Assume independent \eqn{X_1 \sim \mathrm{Pois}(\lambda_1 T_1)} and
\eqn{X_2 \sim \mathrm{Pois}(\lambda_2 T_2)} with known exposures
\eqn{T_1} and \eqn{T_2}. The null hypothesis is
\eqn{H_0:\lambda_1=\lambda_2}.

For hypothesis testing, the function uses the exact conditional
representation under \eqn{H_0}:
\deqn{
X_1 \mid (X_1+X_2=n)
\sim
\mathrm{Binom}\!\left(n,\; \frac{T_1}{T_1+T_2}\right),
}
and applies the same large-sample normal approximation as
\code{\link[stats]{prop.test}} (with optional Yates continuity correction)
to obtain the test statistic and p-value.

For estimation and confidence intervals, the inference target is the
difference between the two rates,
\eqn{\Delta = \lambda_1 - \lambda_2}.
The point estimate is
\eqn{\hat\Delta = X_1/T_1 - X_2/T_2}, and the confidence interval is
constructed using a normal approximation with estimated standard error
\deqn{
\sqrt{X_1/T_1^2 + X_2/T_2^2}.
}
The continuity correction affects the hypothesis test but not the
confidence interval for \eqn{\Delta}.

Confidence intervals:
For one-sample tests, the confidence interval is for \eqn{\lambda} and is
obtained by inverting the same normal approximation on the count scale for
\eqn{\mu=\lambda T}, then dividing by \eqn{T}.
For two-sample tests, the confidence interval is for the difference in rates
\eqn{\lambda_1-\lambda_2}, analogous to the difference in proportions in
\code{\link[stats]{prop.test}}.
}
\examples{
## One-sample test: compare observed rate to a reference unit rate
rate.test(x = 411, T = 25800, r = 0.0119)
rate.test(x = 411, T = 25800, r = 0.0119, correct = FALSE)

## Two-sample test: compare two Poisson rates
rate.test(x = c(12, 5), T = c(100, 80))
rate.test(x = c(12, 5), T = c(100, 80), correct = FALSE)

## One-sided alternative
rate.test(x = 411, T = 25800, r = 0.0119, alternative = "greater")

}
\seealso{
\code{\link[stats]{prop.test}}, \code{\link[stats]{poisson.test}}
}
